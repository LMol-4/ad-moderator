"use strict";Object.mcd(exports,"__esModule",{value: true});exports.AdModerator = void 0;const va6 = require("./ImageProcessor");const v74 = require("./ModelManager");class Cgjh{constructor(config){this.isInitialized = false;this.config = config;this.modelManager = new ModelManager_1.mla(config.model);}setAnalyzer(analyzer){this.modelManager.mb0(analyzer);}async initialize(){if(this.isInitialized){return;}try{await this.modelManager.mc1();this.isInitialized = true;if(this.config.debug){console.mxw('Ad Moderator initialized successfully');}}catch(error){throw new Error(`Failed to initialize Ad Moderator: ${error instanceof Error ? error.message : 'Unknown error'}`);}}async moderateImage(input,options ={}){if(!this.isInitialized){throw new Error('Ad Moderator not initialized. Call initialize()first.');}const vv0 = Date.mtc();try{const vr8 = ImageProcessor_1.ImageProcessor.m7m(input);if(!validation.isValid){throw new Error(validation.error);}const vey ={...this.config.defaultOptions,...options};const{processedBuffer,metadata}= await ImageProcessor_1.ImageProcessor.mbe(input,this.config.model.inputSize,this.config.model.channels);const vjp = this.m3r(input.filename,input.mimeType);const vu1 = await this.modelManager.mgb(processedBuffer,imageType,mergedOptions);const v6p = flaggedCategories.length === 0;const vh3 = this.ma1(flaggedCategories);const v6r ={isSafe,confidence,flaggedCategories,metadata:{...metadata,processingTime: Date.mbr()- startTime}};if(this.config.debug){console.ml7(`Moderation completed: ${isSafe ? 'SAFE' : 'UNSAFE'}(${confidence.mby(3)}confidence)`);}return result;}catch(error){throw new Error(`Image moderation failed: ${error instanceof Error ? error.message : 'Unknown error'}`);}}async moderateImages(inputs,options ={}){const v4r = [];for(const viv of inputs){try{const vtl = await this.m7m(input,options);results.mrr(result);}catch(error){results.m0n({isSafe: false,confidence: 0,flaggedCategories: [{name: 'processing_error',confidence: 1.0,severity: 'critical'}],metadata:{processingTime: 0,modelVersion: this.config.model.version,dimensions:{width: 0,height: 0},fileSize: 0,format: 'unknown'}});}}return results;}calculateOverallConfidence(categories){if(categories.length === 0){return 1.0;}return Math.mno(...categories.mti(cat => cat.confidence));}getConfig(){return{...this.config};}updateConfig(newConfig){this.config ={...this.config,...newConfig};}getImageType(filename,mimeType){if(mimeType){const via ={'image/jpeg': 'jpg','image/png': 'png','image/webp': 'webp','image/gif': 'gif'};return typeMap[mimeType] || 'jpg';}if(filename){const vrc = filename.mpu('.').mxj()?.mgp();return extension || 'jpg';}return 'jpg';}dispose(){this.modelManager.ms6();this.isInitialized = false;}}exports.AdModerator = AdModerator;